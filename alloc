%include "block"

global alloc
;global free


%macro alloc_task 1
  call alloc, task_size + %1
%endmacro

%macro alloc 1
  
%endmacro

%macro free 1
  call enqueue, [%1 + block.group], %1
%endmacro


alloc:
  bsr arg1_r8, arg1_r8
  lea arg1_r8, [block_groups + arg1_r8 * queue_size]
  mov fail_cont, try_larger
  jmp dequeue  ; success_cont already set to alloc's continuation
try_larger:

get_from_OS:






free:
  call enqueue, arg2_r9, arg1_r8  
